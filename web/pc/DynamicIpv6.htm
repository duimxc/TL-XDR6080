
<div class="block">
	<ul class="gridLine gridLineA">
		<label class="desLblA">{%label.netMode%}</label>
		<li class="textConA textCon">
			<span id="wanSel" class="select">
				<span class="value hsValueA"></span>
				<i class="arrow"></i>
			</span>
		</li>
	</ul>
	<ul class="gridLine gridLineA mpPhoneRgt15">
		<label class="desLblA">{%label.ipv6Addr%}</label>
		<label id="ip" class="noteLbl"></label>
	</ul>
	<ul class="gridLine gridLineA mpPhoneRgt10">
		<label class="desLblA">{%label.gateway%}</label>
		<label id="gateway" class="noteLbl"></label>
	</ul>
	<ul class="gridLine gridLineA mpPhoneRgt10">
		<label class="desLblA">{%label.dns0%}</label>
		<label id="pri_dns" class="noteLbl"></label>
	</ul>
	<ul class="gridLine gridLineA mpPhoneRgt10">
		<label class="desLblA">{%label.dns1%}</label>
		<label id="snd_dns" class="noteLbl"></label>
	</ul>
	<div class="blockFuncA">
		<input id="connect" type="button" value="{%btn.renew%}" class="btnA subBtn" />
		<input id="save" type="button" value="{%btn.save%}" class="btnA subBtn" />
	</div>
	<ul id="wanStatus" class="gridLine gridLineA gridStatus">
		<i></i>
		<label id="wanStatusLbl" class="noteLbl"></label>
	</ul>
</div>
<div class="title">
	<label class="title">{%label.highSet%}</label>
	<i class="helpBtn" helpStr="dynamicIpv6AdvHelp"></i>
</div>
<div class="block">
	<ul class="gridLine gridLineA">
		<label class="desLblA">{%label.ipv6GetPtl%}</label>
		<input id="PtlAuto" name="ipv6GetPtlSwitch" class="switchRadio" type="radio" /><label class="noteLbl" for="PtlAuto">{%label.ipv6Auto%}</label>
		<input id="PtlDHCPv6" name="ipv6GetPtlSwitch" class="switchRadio" type="radio" /><label class="noteLbl" for="PtlDHCPv6">{%label.ipv6DHCPv6%}</label>
		<input id="PtlSLAAC" name="ipv6GetPtlSwitch" class="switchRadio" type="radio" /><label class="noteLbl" for="PtlSLAAC">{%label.ipv6SLAAC%}</label>
	</ul>
	<ul class="gridLine gridLineA">
		<label class="desLblA">{%label.ipv6PreDelg%}</label>
		<input id="PreDelgOn" name="ipv6PreDelgSwitch" class="switchRadio" type="radio" /><label class="noteLbl" for="PreDelgOn">{%label.ipv6On%}</label>
		<input id="PreDelgOff" name="ipv6PreDelgSwitch" class="switchRadio" type="radio" /><label class="noteLbl" for="PreDelgOff">{%label.ipv6Off%}</label>
	</ul>
	<ul class="gridLine gridLineA">
		<label class="desLblA">{%label.dns%}</label>
		<input id="dnsAuto" name="ipv6DnsSwitch" class="switchRadio" type="radio" /><label class="noteLbl" for="dnsAuto">{%label.ipv6DnsAuto%}</label>
		<input id="dnsManual" name="ipv6DnsSwitch" class="switchRadio" type="radio" /><label class="noteLbl" for="dnsManual">{%label.ipv6DnsManual%}</label>
	</ul>
	<ul class="gridLine gridLineA dnsInput">
		<label class="desLblA">{%label.dns0%}</label>
		<li class="textConA textCon"><input id="pri_dns_input" class="textA text hoverBd" maxLength="39" /><i class="tip"></i></li>
	</ul>
	<ul class="gridLine gridLineA dnsInput">
		<label class="desLblA">{%label.dns1%}</label>
		<li class="textConA textCon"><input id="snd_dns_input" class="textA text hoverBd" maxLength="39" /><i class="tip"></i></li>
	</ul>
	<ul class="gridLine gridLineA">
		<label class="desLblA">{%label.wanMac%}</label>
		<li class="textConA textCon">
			<span id="wanMacSel" class="select">
				<span class="value hsValueA"></span>
				<i class="arrow"></i>
			</span>
		</li>
	</ul>
	<ul id="macCloneUl" class="gridLine gridLineA">
		<li class="textConAL textCon"><input id="wanMac" class="textA text hoverBd" maxLength="17" /><i class="tip"></i></li>
		<li class="textConAL macCloneLi"></li>
	</ul>
	<div class="blockFuncA">
		<input id="saveHighSet" type="button" value="{%btn.save%}" class="btnA subBtn" />
	</div>
</div>
<script type="text/javascript">function init(e){function n(b,d){var a="";switch(b){case ENONE:return!1;case EIPV6INVFDNSVR:a=errStr.primDnsErr;break;case EIPV6INVSDNSVR:a=errStr.seDnsErr;break;case ENOLINK:a=errStr.wanLinkDown;break;case EIPV6LINKLOCAL:a=errStr.ipv6LinkLoaclErr;break;case ECONFLICTLANMAC:a=errStr.lanWanMacConflict;break;case ECONFLICTWANMAC:a=errStr.mulWanMacConflict;break;default:a=errStr.invRequestFail}showAlert(a,d);return!0}function v(b){wanCheckWDS(function(){var d={},a={},c={};d[f]=a;1==b||"undefined"==typeof b?
a[WAN_NAME]=c:a[WAN_NAME+"_"+b]=c;c[w]=DHCP_NAME;disableBtn("saveHighSet",!0);disableBtn("connect",!0);setLoadingId("save");hsLoading(!0);$.modify(d,function(a){g=DHCP_NAME;l==PD_MODE_PREFIX?(lanPrefixChange(!0),preDelgOnFlag=!0):setTimeout(function(){lanPrefixChange(!1);preDelgOnFlag=!1},2E3);hsLoading(!1,function(){disableBtn("saveHighSet",!1);disableBtn("connect",!1)})});refreshWanStatus(b)})}function x(b){wanCheckWDS(function(){var d={},a={},c={},e={};d[f]=a;1==b||"undefined"==typeof b?(a[s]=
e,a[DHCP_NAME]=c):(a[s+"_"+b]=e,a[DHCP_NAME+"_"+b]=c);var m,p,h,k,q,r,a=id("PtlAuto").checked?IP_CONFIG_AUTO:id("PtlDHCPv6").checked?IP_CONFIG_DHCPV6:IP_CONFIG_SLAAC;m=id("PreDelgOn").checked?PD_MODE_PREFIX:PD_MODE_NON_TEMP;p=id("dnsAuto").checked?DNS_MODE_DYN:DNS_MODE_MAN;h=id("pri_dns_input").value;k=id("snd_dns_input").value;q=id("wanMac");r=q.value;if(!wanMacErrHandle(checkMac(r),q)){c[y]=a;c[z]=m;c[A]=p;if(p==DNS_MODE_MAN){if(n(checkPriDnsV6(h),"pri_dns_input")||n(checkSeDnsV6(k),"snd_dns_input"))return;
h=h.replace(/：/g,":");$("#pri_dns_input").val(h);k=k.replace(/：/g,":");$("#snd_dns_input").val(k);c[B]=h;c[C]=k}e[D]=r;updateTimerHandle&&clearTimeout(updateTimerHandle);disableBtn("save",!0);disableBtn("connect",!0);setLoadingId("saveHighSet");hsLoading(!0);$.modify(d,function(a){g==DHCP_NAME&&(m==PD_MODE_PREFIX?(lanPrefixChange(!0),preDelgOnFlag=!0):setTimeout(function(){lanPrefixChange(!1);preDelgOnFlag=!1},2E3));t(b);hsLoading(!1,function(){disableBtn("save",!1);disableBtn("connect",!1)});l=m;
updateTimerHandle=$.setTimeout(function(){refreshWanStatus(b)},0);return n(a[ERR_CODE])})}})}function E(b){wanCheckWDS(function(){data=1==b||"undefined"==typeof b?{network:{change_wanv6_status:{proto:"dhcpcv6",operate:"renew"}}}:{network:{change_wanv6_status:{proto:"dhcpcv6_"+b,operate:"renew"}}};disableBtn("save",!0);disableBtn("saveHighSet",!0);setLoadingId("connect");hsLoading(!0);hsStatSet("link",linkStatus[LINKING_UP]);$.action(data,function(b){hsLoading(!1,function(){disableBtn("save",!1);disableBtn("saveHighSet",
!1)})})})}function t(b){var d={};d[f]={};1==b||"undefined"==typeof b?(d[f][KEY_NAME]=[WAN_NAME,DHCP_NAME,"wan"],d[uciNetwork.fileName]={},d[uciNetwork.fileName][KEY_NAME]=[WAN_STATUS_NAME,uciNetwork.dynData.ifaceMac,uciNetwork.secName.lan]):(d[f][KEY_NAME]=[WAN_NAME+"_"+b,DHCP_NAME+"_"+b,"wan_"+b],d[uciNetwork.fileName]={},d[uciNetwork.fileName][KEY_NAME]=[WAN_STATUS_NAME+"_"+b,uciNetwork.dynData.ifaceMac,uciNetwork.secName.lan]);$.query(d,function(a){var c=a[f];2<=b&&"undefined"!=typeof b?(c=c[DHCP_NAME+
"_"+b],g=a[uciNetwork.fileName][WAN_STATUS_NAME+"_"+b].proto):(c=c[DHCP_NAME],g=a[uciNetwork.fileName][WAN_STATUS_NAME].proto);id("PtlAuto").checked=c.ip_config==IP_CONFIG_AUTO?1:0;id("PtlDHCPv6").checked=c.ip_config==IP_CONFIG_DHCPV6?1:0;id("PtlSLAAC").checked=c.ip_config==IP_CONFIG_SLAAC?1:0;l=c.pd_mode;"undefined"!=typeof b?(l=PD_MODE_NON_TEMP,id("PreDelgOff").checked=1,lanPrefixChange(!1),preDelgOnFlag=!1,disableBtn("PreDelgOn",!0),disableBtn("PreDelgOff",!0)):(curSysMode==uciSystem.optValue.sysMode.routerMode&&
(disableBtn("PreDelgOn",!1),disableBtn("PreDelgOff",!1)),c.pd_mode==PD_MODE_NON_TEMP?(id("PreDelgOff").checked=1,g==DHCP_NAME&&(lanPrefixChange(!1),preDelgOnFlag=!1)):(id("PreDelgOn").checked=1,g==DHCP_NAME&&(lanPrefixChange(!0),preDelgOnFlag=!0)));c.dns_mode==DNS_MODE_DYN?id("dnsAuto").click():(id("pri_dns_input").value=c.pri_dns||"::",id("snd_dns_input").value=c.snd_dns,id("dnsManual").click());setMacInfo(a,b);u(a,b)})}function u(b,d){var a;a=1==d||"undefined"==typeof d?b[uciNetwork.fileName][WAN_STATUS_NAME]:
b[uciNetwork.fileName][WAN_STATUS_NAME+"_"+d];var c;if(a.proto!=DHCP_NAME)clearTimeout(updateTimerHandle);else switch(parseInt(a.link_status)){case LINK_DOWN:id("ip").innerHTML="::/64";id("gateway").innerHTML="::";id("pri_dns").innerHTML="::";id("snd_dns").innerHTML="::";curSysMode==uciSystem.optValue.sysMode.routerMode&&disableBtn("connect",!1);c=a[uciNetwork.optName.code];if(LINK_CODE_MANUAL!=c&&LINK_CODE_NORMAL!=c&&LINK_CODE_INET_ERR!=c){hsStatSet("error",linkStatus[LINK_DOWN]+label.lBrackets+
linkCode[c]+label.rBrackets);break}hsStatSet("error",linkStatus[LINK_DOWN]);break;case LINK_UP:id("ip").innerHTML=(a.ip6addr||"::")+"/64";id("gateway").innerHTML=a.ip6gw||"::";id("pri_dns").innerHTML=a.pri_dns||"::";id("snd_dns").innerHTML=a.snd_dns||"::";curSysMode==uciSystem.optValue.sysMode.routerMode&&disableBtn("connect",!1);hsStatSet("correct",linkStatus[LINK_UP]);break;case LINKING_DOWN:hsStatSet("link",linkStatus[LINKING_DOWN]);id("ip").innerHTML="::/64";id("gateway").innerHTML="::";id("pri_dns").innerHTML=
"::";id("snd_dns").innerHTML="::";curSysMode==uciSystem.optValue.sysMode.routerMode&&disableBtn("connect",!1);break;case LINKING_UP:c=a[uciNetwork.optName.code];if(c==LINK_CODE_INET_ERR){hsStatSet("link",linkStatus[LINKING_UP]+label.lBrackets+linkCode[LINK_CODE_NOECHO]+label.rBrackets);id("ip").innerHTML=(a.ip6addr||"::")+"/64";id("gateway").innerHTML=a.ip6gw||"::";id("pri_dns").innerHTML=a.pri_dns||"::";id("snd_dns").innerHTML=a.snd_dns||"::";curSysMode==uciSystem.optValue.sysMode.routerMode&&disableBtn("connect",
!1);break}else hsStatSet("link",linkStatus[LINKING_UP]);id("ip").innerHTML="::/64";id("gateway").innerHTML="::";id("pri_dns").innerHTML="::";id("snd_dns").innerHTML="::";curSysMode==uciSystem.optValue.sysMode.routerMode&&disableBtn("connect",!1)}}var f="protocol",s="wan",w=uciProto.optName.type,B="pri_dns",C="snd_dns",z="pd_mode",y="ip_config",A="dns_mode",D=uciProto.optName.macaddr,l,g;refreshWanStatus=function(b){var d={};d[uciNetwork.fileName]={};d[uciNetwork.fileName][KEY_NAME]=2<=b&&"undefined"!=
typeof b?WAN_STATUS_NAME+"_"+b:WAN_STATUS_NAME;updateTimerHandle&&clearTimeout(updateTimerHandle);$.query(d,function(a){u(a,b);updateTimerHandle=$.setTimeout(function(){refreshWanStatus(b)},2E3)})};$("[name=ipv6DnsSwitch]").change(function(b){"dnsAuto"==this.id?$("ul.dnsInput").css("display","none"):$("ul.dnsInput").css("display","block")});if("undefined"==typeof e)selectInit("wanSel",wanOptions,LINK_TYPE_DHCP,wanSelectChange);else{var F=wanOptions.slice(0,wanOptions.length-1);selectInit("wanSel",
F,LINK_TYPE_DHCP,wanSelectChange)}disableBtn("connect",!0);curSysMode!=uciSystem.optValue.sysMode.routerMode&&(id("wanSel").disable(!0),disableBtn("save",!0),disableBtn("saveHighSet",!0),disableInput("PtlAuto",!0),disableInput("PtlDHCPv6",!0),disableInput("PtlSLAAC",!0),disableInput("wanMac",!0),disableInput("pri_dns_input",!0),disableInput("snd_dns_input",!0),disableBtn("PreDelgOn",!0),disableBtn("PreDelgOff",!0),disableBtn("dnsAuto",!0),disableBtn("dnsManual",!0));id("saveHighSet").onclick=function(){x(e)};
id("connect").onclick=function(){E(e)};id("save").onclick=function(){v(e)};t(e);refreshWanStatus(e);refreshLanStatus(e)}function initWanPortSel(){if($("#dualWanIpv6Wrapper").is(":hidden"))init();else{var e=$("#dualWanIpv6Wrapper").find("label.selected").index()+1;init(e)}}initWanPortSel();
</script><style type="text/css">ul.dnsInput{display:none}</style>