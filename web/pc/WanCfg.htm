<script type="text/javascript">var wanDetecting=!1,ROUTER_MAC="routerMac",CLONE_MAC="cloneMac",CUSTOM_MAC="customMac",wanOptions=[{str:label.pppoe,value:LINK_TYPE_PPPOE},{str:label.staticIp,value:LINK_TYPE_STATIC_IP},{str:label.dhcp,value:LINK_TYPE_DHCP}],rateOptions=[],rateChoice=[{str:label.dupAuto100M,value:"auto"},{str:label.dup10MF,value:"10F"},{str:label.dup10MH,value:"10H"},{str:label.dup100MF,value:"100F"},{str:label.dup100MH,value:"100H"},{str:label.dup1000MH,value:"1000H"},{str:label.dup1000MF,value:"1000F"}],wanMacOptions=
[{str:label.routerMac,value:ROUTER_MAC},{str:label.cloneMac,value:CLONE_MAC},{str:label.customMac,value:CUSTOM_MAC}],wanProto=uciProto.optValue.proto,wanTypes=["DynamicIp.htm","StaticIp.htm","PPPoE.htm"],wanTypesToVal={},WAN=uciNetwork.optValue.ifname.wan,HOST=uciNetwork.optValue.ifname.host,FACTORY=uciNetwork.optValue.ifname.factory,wanMacVal,hostMacVal,factoryMacVal,mac={},wanTypeLast,wanPortSelTmp,wanPortIndexList,dualWanOpen=!1,currentSelectedWan=-1,currentSelectPos=[],currentSelectHardType=[],
curSysMode=uciSystem.optValue.sysMode.routerMode;wanTypesToVal[wanProto.dynIp]=0;wanTypesToVal[wanProto.staticIp]=1;wanTypesToVal[wanProto.pppoe]=2;function wanMacErrHandle(a,c){var b="";switch(a){case ENONE:return!1;case EINVMACFMT:b=errStr.macFmtErr;break;case EINVMACZERO:b=errStr.macZeroErr;break;case EINVMACBROAD:b=errStr.macBroadErr;break;case EINVMACGROUP:b=errStr.macGroupErr;break;default:b=errStr.invRequestFail}showAlert(b,c);return!0}
function wanSetImgOnClick(a){gSupportWanPortSwap&&!id("wanSetAuto").checked&&(id("sampleImg").src="../web-static/images/wanSetFixed"+a+".png",wanPortSelTmp=a)}function getWanRateOption(a){for(var c=0,b=rateOptions.length;c<b;c++)if(rateOptions[c].value==a)return a;return"auto"}function getBridgeStatus(){var a={};a[uciCustomNetwork.fileName]={};a[uciCustomNetwork.fileName][KEY_NAME]=[uciCustomNetwork.dynData.bridgestatus];$.query(a,realSetMacInfo)}
function brigeModelUiAdjust(){var a=isIESix||isIESeven?"inline":"inline-block",c=id("wanMac"),b=$("#macCloneUl li");c.value=b[1].innerHTML=factoryMacVal.toUpperCase();b[1].style.display=a;b[0].style.display="none";document.getElementById("wanMacSel").children[1].setAttribute("class","arrow arrowDis");document.getElementById("elinkWarn").style.width="177px";document.getElementById("elinkWarn").style.lineHeight="15px";document.getElementById("elinkWarn").style.marginLeft="10px";document.getElementById("elinkWarn").innerHTML=
"设备处于桥模式，已恢复出厂MAC，且此模式下不允许更改MAC地址。";document.getElementById("wanMacSel").children[0].innerHTML="使用路由器的MAC地址";hiddenSaveButton()}
function realSetMacInfo(a){for(var c,b=Object.keys(a.protocol),d=/wan/,e=0;e<b.length;e++)if(d.test(b[e])){c=b[e];break}b=id("wanMac");wanMacVal=a.protocol[c].macaddr;hostMacVal=mac[HOST];factoryMacVal=a.protocol[c].fac_macaddr;b.value=wanMacVal.toUpperCase();c=wanMacVal.toUpperCase()==factoryMacVal.toUpperCase()?ROUTER_MAC:wanMacVal.toUpperCase()==hostMacVal.toUpperCase()?CLONE_MAC:CUSTOM_MAC;gModeSwitchSupport&&1==parseInt(a.custom_network.bridge_status.enable)?brigeModelUiAdjust():(selectInit("wanMacSel",
wanMacOptions,c,wanMacSelectChange),wanMacSelectChange(c))}function setMacInfo(a){mac=a[uciNetwork.fileName][uciNetwork.dynData.ifaceMac];gModeSwitchSupport?getBridgeStatus():realSetMacInfo(a)}
function wanMacSelectChange(a){var c=isIESix||isIESeven?"inline":"inline-block",b=id("wanMac"),d=$("#macCloneUl li");switch(a){case ROUTER_MAC:b.value=d[1].innerHTML=factoryMacVal.toUpperCase();d[1].style.display=c;d[0].style.display="none";break;case CLONE_MAC:b.value=d[1].innerHTML=hostMacVal.toUpperCase();d[1].style.display=c;d[0].style.display="none";break;case CUSTOM_MAC:b.value=wanMacVal.toUpperCase(),d[0].style.display=c,d[1].style.display="none"}}
function wanSelectChange(a){""==a.toString()&&(a=LINK_TYPE_PPPOE);loadPage(wanTypes[a],"routeSetRCon")}function getWanPortTipsText(a){var c="";$.each(wanPortDescList,function(b,d){a!=d&&(c=""==c?b:"、"+b)});return c}function wanPortSelectChange(a){$("#wanPortSelected").html(getWanPortTipsText(a))}
function wanDetectResult(){if(!1!=wanDetecting){var a={};a[uciNetwork.fileName]={};a[uciNetwork.fileName][uciNetwork.action.wanDetect]=null;$.action(a,function(a){a=parseInt(a[uciNetwork.optName.proto]);switch(a){case WAN_IFACE_NOT_LINK:showAlert(errStr.wanLinkDown);wanDetectStop();closeLoading();return;case ERROR_INTERNEL_ERROR:case ERROR_INPUT_PARA_ERROR:wanDetectStop();closeLoading();return;case WAN_TYPE_DHCP:case WAN_TYPE_STATIC:case WAN_TYPE_PPPOE:break;default:$.setTimeout(wanDetectResult,1E3);
return}wanDetectStop();closeLoading();wanSelectChange(a-1)})}}function wanDetectStop(){wanDetecting=!1}function wanDetect(){var a={};a[uciNetwork.fileName]={};a[uciNetwork.fileName][uciNetwork.action.wanDetect]=null;$.action(a,function(a){switch(parseInt(a[uciNetwork.optName.proto])){case WAN_IFACE_NOT_LINK:showAlert(errStr.wanLinkDown);break;default:wanDetecting=!0,showLoading(label.checkingWait,wanDetectStop),$.setTimeout(wanDetectResult,2E3)}})}
function wanCheckWDS(a){var c={};c[uciWireless.fileName]={};c[uciWireless.fileName][KEY_NAME]=[uciWireless.dynData.wds_2g,uciWireless.dynData.wds_5g];$.query(c,function(b){b[ERR_CODE]!=ENONE||b[uciWireless.fileName][uciWireless.dynData.wds_2g][uciWireless.dynOptName.enable]!=uciWireless.dynOptValue.enable.on&&b[uciWireless.fileName][uciWireless.dynData.wds_5g][uciWireless.dynOptName.enable]!=uciWireless.dynOptValue.enable.on?"function"==typeof a&&a():showAlert(label.wanWDSTip)})}
function setRateOptions(a,c){var b;a.splice(0,a.length);b=c[uciFunction.optName.ethBandwidth];"100"==b?rateChoice[0].str=label.dupAuto100M:"1000"==b&&(rateChoice[0].str=label.dupAuto1000M);b=c[uciFunction.optName.wanRate];for(var d=0;d<b.length;d++)for(var e=0;e<rateChoice.length;e++)if(b[d]==rateChoice[e].value){a.push(rateChoice[e]);break}}
function initDynamicPortRate(a,c){var b=Object.keys(wanPortRateList).length,d;d="left"==c?a:b-a-1;b=wanPortRateList[d];d=wanPortRateDescList[d];for(var e=[],f=0;f<b.length;f++)e.push({str:d[f],value:b[f]});return e}function checkIfWanRateShouldChange(a,c){for(var b=wanPortRateList[a],d=0;d<b.length;d++)if(b[d]==c)return!1;return!0}
function initDualWanPort(){var a=$(".dualWanWrapper").find("label");a[0].onclick=function(){a[1].className="";a[0].className="selected";currentSelectedWan=1;initWanSet();gBasicRouteSetRNiceScroll.scrollTo(0)};a[1].onclick=function(){a[0].className="";a[1].className="selected";currentSelectedWan=2;initWanSet();gBasicRouteSetRNiceScroll.scrollTo(0)};1==currentSelectedWan||2==currentSelectedWan?a[currentSelectedWan-1].click():a[0].click()}
function setWanOptions(a){wanOptions=[];wanTypes=[];for(var c=0;c<a.dial_mode.length;++c)switch(a.dial_mode[c]){case "dhcp":wanOptions.push({str:label.dhcp,value:LINK_TYPE_DHCP});wanTypes.push("DynamicIp.htm");break;case "staticip":wanOptions.push({str:label.staticIp,value:LINK_TYPE_STATIC_IP});wanTypes.push("StaticIp.htm");break;case "pppoe":wanOptions.push({str:label.pppoe,value:LINK_TYPE_PPPOE});wanTypes.push("PPPoE.htm");break;case "wired_relay":wanOptions.push({str:label.wiredRepeater,value:LINK_TYPE_WIRED_REPEATER});
wanTypes[LINK_TYPE_WIRED_REPEATER]="WiredRepeater.htm";break;case "wds_relay":wanOptions.push({str:label.wirelessRepeater,value:LINK_TYPE_WIRELESS_REPEATER}),wanTypes[LINK_TYPE_WIRELESS_REPEATER]="WirelessRepeater.htm"}}
function initWanSet(){var a=!1;dualWanOpen&&1!=currentSelectedWan&&(a=!0);var c={};c[uciProto.fileName]={};c[uciProto.fileName][KEY_NAME]=a?uciProto.secName.wan+"_"+currentSelectedWan:uciProto.secName.wan;c[uciFunction.fileName]={};c[uciFunction.fileName][KEY_NAME]=uciFunction.secName.newModuleSpec;gSysModeSupport&&!dualWanOpen&&(c[uciSystem.fileName]={},c[uciSystem.fileName][KEY_NAME]=uciSystem.secName.sysMode);$.query(c,function(b){var c={},c=b[uciFunction.fileName][uciFunction.secName.newModuleSpec];
setRateOptions(rateOptions,c);setWanOptions(c);gSupportWanPortSwap&&gWanPortDetectSupport&&(wanPortIndexList=c[uciFunction.optName.wanPortIndexList]);!0==$.local?b=LINK_TYPE_PPPOE:gSysModeSupport&&!dualWanOpen?(curSysMode=b[uciSystem.fileName][uciSystem.secName.sysMode][uciSystem.optName.mode],b=curSysMode==uciSystem.optValue.sysMode.apMode?LINK_TYPE_WIRED_REPEATER:curSysMode==uciSystem.optValue.sysMode.wdsMode?LINK_TYPE_WIRELESS_REPEATER:a?wanTypesToVal[b[uciProto.fileName][uciProto.secName.wan+
"_"+currentSelectedWan][uciProto.optName.type]]:wanTypesToVal[b[uciProto.fileName][uciProto.secName.wan][uciProto.optName.type]]):b=a?wanTypesToVal[b[uciProto.fileName][uciProto.secName.wan+"_"+currentSelectedWan][uciProto.optName.type]]:wanTypesToVal[b[uciProto.fileName][uciProto.secName.wan][uciProto.optName.type]];wanSelectChange(b)})}var WANNUM=2,arg={network:{name:"lan"}};gSysModeSupport&&(arg.system={name:"sys_mode"});
$.query(arg,function(a){var c=a.network.lan.macaddr.toUpperCase(),b=uciSystem.optValue.sysMode.routerMode;gSysModeSupport&&(b=a.system.sys_mode.mode);gMulWanSupport&&b==uciSystem.optValue.sysMode.routerMode?$.query({port_manage:{table:"dev_info"}},function(a){var b=a.port_manage.dev_info,f,g;for(a=0;a<b.length;a++)1==b[a].cap&&b[a].mac.toUpperCase()==c&&(g=a,f=b[a].phy_num);$.query({port_manage:{table:"mwan"}},function(a){dualWanOpen=!0;for(var c=0,d=0;d<WANNUM;d++)0==a.port_manage.mwan[d]["mwan_"+
(d+1)].enable&&(dualWanOpen=!1);for(d=0;d<f;d++)currentSelectHardType[d]="SFP"==b[g].phy_info[d].type.toUpperCase(),"WAN"==b[g].phy_info[d].role.slice(0,3).toUpperCase()&&(c++,"WAN1"==b[g].phy_info[d].role.toUpperCase()?currentSelectPos[0]=d:currentSelectPos[1]=d);dualWanOpen&&c==WANNUM?($("#dualWanWrapper").show(),initDualWanPort()):($("#dualWanWrapper").hide(),initWanSet())})}):($("#dualWanWrapper").hide(),initWanSet())});
</script>