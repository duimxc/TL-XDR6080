

<h1 class="phoneTitle">{%label.phWDSTitle%}</h1>
<div class="textCenter" id="detecting">
	<img class="detectingGif" src="../web-static/images/wzdDetecting.gif" />
	<p id="scanList" class="detectTip">{%label.phScanWifi%}</p>
</div>
<div class="disNone">
	<div class="blockTable">
		<label id="refreshBtn">
			刷新
			<i class="refresh"></i>
		</label>
		<p class="WDSTitle">
			<span>{%label.phSelectRouters%}</span>
		</p>
		<div id="scrollCon">
			<table id="WDSTbl" class="dataGrid"></table>
		</div>
	</div>
	<p id="WDSScanFail">未发现路由器，请刷新重试</p>
	<!-- <div class="WDSAddHandleCon">
		<p class="WDSAddHandle"><span>{%label.phWDSAddHandle%}</span></p>
	</div> -->
	<div class="phFunc">
		<label id="next" class="phOneBtn">下一步</label>
		<label id="refresh" class="phOneBtn">刷新</label>
	</div>
	<a id="reDetect" class="reDetectNet" href="javascript:void(0);">{%label.phReDetectNetType%}</a>
</div><script type="text/javascript">var wdsTargetIndex=[];
function init(){function x(q){var d=[],a;tmpApList={};for(var e in f)if(f[e]){a=gWDSModel[e].wlan_scan;var g=tmpApList,b=e;a=q.wireless[a];for(var c=e,k=a.length,l=[],h=0;h<k;h++){var m=h+1;l[h]={};l[h].freq=c;l[h].freqArr=[c];l[h].freqInfo=gFreqInfo[c];l[h].ssid=a[h]["ap_"+m].ssid;l[h].encryption=a[h]["ap_"+m].encryption;l[h].rssi=a[h]["ap_"+m].rssi;l[h].signal=20<=a[h]["ap_"+m].rssi?30<=a[h]["ap_"+m].rssi?4:3:10<=a[h]["ap_"+m].rssi?2:1}g[b]=l;for(g=0;g<tmpApList[e].length;++g){b=!1;for(a=0;a<d.length;++a)if(d[a].ssid==
tmpApList[e][g].ssid&&d[a].encryption==tmpApList[e][g].encryption){b=!0;d[a].rssi=Math.max(d[a].rssi,tmpApList[e][g].rssi);d[a].signal=Math.max(d[a].signal,tmpApList[e][g].signal);-1==$.inArray(tmpApList[e][g].freq,d[a].freqArr)&&(d[a].freqArr.push(tmpApList[e][g].freq),d[a].freqInfo=d[a].freqInfo+" & "+tmpApList[e][g].freqInfo,d[a].freq=FREQ_BS);break}b||d.push(tmpApList[e][g])}}return d}function u(){var c={wireless:{table:[]}},d;for(d in f)f[d]&&c.wireless.table.push(gWDSModel[d].wlan_scan);$.query(c,
function(a){closeLoading();clearTimeout(r);$("#detecting").css("display","none");$(".disNone").css("display","block");scanList=[];n.setDataSource(scanList);n.refresh(1);ENONE==a[ERR_CODE]?(scanList=x(a),scanList.sort(function(a,d){var b=parseInt(a.rssi),c=parseInt(d.rssi);return b>c?1:b==c?0:-1}),scanList=scanList.slice(-p),0==scanList.length?($("#WDSScanFail").css("display","block"),$("#refresh").css("display","block"),$(".blockTable").css("display","none"),$("#next").css("display","none")):($("#WDSScanFail").css("display",
"none"),$("#refresh").css("display","none"),$(".blockTable").css("display","block"),$("#next").css("display","block")),wdsTargetIndex=[],wdsTargetSelFreq={}):(scanList=[],scanList.length=0,$("#WDSScanFail").css("display","block"),$("#refresh").css("display","block"),$(".blockTable").css("display","none"),$("#next").css("display","none"),errHandle(a[ERR_CODE]));n.setDataSource(scanList);n.refresh(1)})}function v(){if(6<=s)u();else{var c={wireless:{name:[]}},d;for(d in f)f[d]&&c.wireless.name.push(gWDSModel[d].wlan_scan_status);
$.query(c,function(a){var c=!0,d;for(d in a.wireless)1!=a.wireless[d].status&&(c=!1);!0==c?u():(s++,r=$.setTimeout(v,2E3))})}}function t(){c[FREQ_2G]=!1;c[FREQ_5G]=!1;c[FREQ_5G1]=!1;c[FREQ_5G4]=!1;$("#detecting").show();$("#scanList").show();$(".disNone").hide();for(var q in f)f[q]&&$.action(gWDSModel[q].scan_start);s=1;r=$.setTimeout(v,3E3)}function w(){0==wdsTargetIndex.length?showPhWzdAlert(errStr.WDSNOHostErr):loadPage("PhoneWlanWDSCfgSecond.htm","phCon")}var p,r=null,n=new DataGrid,s=1,c={};
c[FREQ_2G]=!1;c[FREQ_5G]=!1;c[FREQ_5G1]=!1;c[FREQ_5G4]=!1;tableNiceScroll=new NiceScroll("scrollCon");tableNiceScroll.scrollTipSet({display:"none"});tableNiceScroll.init();var f=[];f[FREQ_2G]=!1;f[FREQ_5G]=!1;f[FREQ_5G1]=!1;f[FREQ_5G4]=!1;switch(gBandNum){case BAND_3:p=192;break;case BAND_2:p=128;break;default:p=64}if(gSupportBS&&"1"==gLocalAPInfo[FREQ_BS].bs_enable){if("1"==gLocalAPInfo[FREQ_BS].wifi_enable)for(var k in gKeyNames[gBandNum].wlan_wds)null!=gKeyNames[gBandNum].wlan_wds[k]&&(f[k]=!0)}else for(k in gLocalAPInfo)FREQ_BS!=
k&&(f[k]="1"==gLocalAPInfo[k].enable);bInWizard=!0;$("#refreshBtn").click(t);$("#refresh").click(t);$("#reDetect").click(function(){loadPage("PhoneNetwork.htm","phCon")});$("#next").click(function(){backFromNextPage=!1;gWifiSwitchSupport||gCustomWifiSwitchSupport?checkWifiSwitchOff(w):w()});n.init({id:"WDSTbl",data:scanList,classCol:{gridClassName:"dataGrid",ListSpanClassName:"ListSpan"},head:[{field:label.select,width:24},{field:label.wirelessNa,width:130},{field:"频段信息",width:100},{field:label.sigDep,
width:24}],list:[{className:"checkboxBtn",classNameUn:"checkboxBtnUn",classNameDis:"checkboxBtnDis",type:"btn",subType:"checkbox",click:function(f,d){closeAlertC();var a=scanList[f].freq,e=scanList[f].freqArr;if("checkboxBtn"==d.obj.className){var g=scanList[f].encryption;if(a==FREQ_BS)for(var b=0;b<e.length;b++)c[e[b]]=!0;else c[a]=!0;if(g!=uciWireless.encryptionType.none&&g!=uciWireless.encryptionType.psk2_psk&&g!=uciWireless.encryptionType.psk2_sae3&&g!=uciWireless.encryptionType.sae3&&g!=uciWireless.encryptionType.wpa3)showPhWzdAlert("所选的路由器加密方式过旧，请将该路由器的加密方式更改为WPA/WPA2-PSK AES或WPA2-PSK/WPA3-SAE后重新连接。"),
d.obj.className="checkboxBtnUn";else{for(b=0;b<scanList.length;b++)if(b!=f&&"checkboxBtn"!=$("#WDSTbl input")[scanList.length-1-b].className)if(scanList[b].freq==FREQ_BS)for(var k=0;k<scanList[b].freqArr.length;k++){if(c[scanList[b].freqArr[k]]){$("#WDSTbl input")[scanList.length-1-b].className="checkboxBtnDis";break}}else c[scanList[b].freq]&&($("#WDSTbl input")[scanList.length-1-b].className="checkboxBtnDis");wdsTargetIndex.push(f);if(a==FREQ_BS)for(b=0;b<e.length;++b)wdsTargetSelFreq[e[b]]={selected:!0,
bs:!0},gRootAPInfo[e[b]].ssid=scanList[f].ssid,gRootAPInfo[e[b]].key="",gRootAPInfo[e[b]].encryption=parseInt(g)?1:0;else wdsTargetSelFreq[a]={selected:!0,bs:!1},gRootAPInfo[a].ssid=scanList[f].ssid,gRootAPInfo[a].key="",gRootAPInfo[a].encryption=parseInt(g)?1:0}}else{if(a==FREQ_BS)for(b=0;b<e.length;b++)c[e[b]]=!1;else c[a]=!1;if(a==FREQ_BS)for(b=0;b<e.length;++b)wdsTargetSelFreq[b]={selected:!1,bs:!1};else wdsTargetSelFreq[a]={selected:!1,bs:!1};wdsTargetIndex.splice($.inArray(f,wdsTargetIndex),
1);if(0==wdsTargetIndex.length)$("#WDSTbl input.checkboxBtnDis").attr("class","checkboxBtnUn");else for(b=0;b<scanList.length;b++)if(scanList[b].freq==FREQ_BS){a=!0;for(k=0;k<scanList[b].freqArr.length;k++)if(c[scanList[b].freqArr[k]]){a=!1;break}a&&($("#WDSTbl input")[scanList.length-1-b].className="checkboxBtnUn")}else c[scanList[b].freq]||($("#WDSTbl input")[scanList.length-1-b].className="checkboxBtnUn")}}},{name:"ssid",maxSize:22},{name:"freqInfo",maxSize:20},{name:"signal",type:"phSignal"}],
checkIndex:1,paging:{num:1E4,page:1},hasSelBox:!1,max:p,edit:!1,niceScroll:tableNiceScroll});t()}init();
</script><style type="text/css">img.detectingGif{height:32px;margin:80px auto 40px;width:32px}p.detectTip{color:#fff;font-size:15px;text-align:center}.textCenter{text-align:center;display:none}#WDSScanFail{margin-top:80px;color:#fff;text-align:center;font-size:14px}i.signalCon{width:24px;height:24px;display:inline-block;text-align:left;vertical-align:middle}i.signalCon i.signal1{height:100%;width:100%;display:inline-block;background:url(../web-static/images/wifi_signal_one@1x.png) no-repeat}i.signalCon i.signal2{height:100%;width:100%;display:inline-block;background:url(../web-static/images/wifi_signal_two@1x.png) no-repeat}i.signalCon i.signal3{height:100%;width:100%;display:inline-block;background:url(../web-static/images/wifi_signal_three@1x.png) no-repeat}i.signalCon i.signal4{height:100%;width:100%;display:inline-block;background:url(../web-static/images/wifi_signal_four@1x.png) no-repeat}i.signalCon i.lock{width:14px;height:14px;display:inline-block;margin-left:-14px;background:url(../web-static/images/wifi_lock@1x.png) no-repeat}p.WDSTitle{color:#fff;font-size:14px;font-weight:bold;line-height:24px;text-align:left!important;margin-left:36px}a.reDetectNet{color:#feeb1a;font-size:14px;display:block;width:112px;text-align:center;margin:37px auto 0}.dataGrid_header_tr{display:none!important}.dataGrid{font-size:14px;color:#fff}input.checkboxBtn{height:24px;width:24px;border:0;font-size:0;cursor:pointer;outline:0;vertical-align:middle;background:url(../web-static/images/CheckBox_checked@1x.png) no-repeat}input.checkboxBtnUn{height:24px;width:24px;border:0;font-size:0;cursor:pointer;outline:0;vertical-align:middle;background:url(../web-static/images/CheckBox_unchecked@1x.png) no-repeat}input.checkboxBtnDis{height:24px;width:24px;border:0;font-size:0;cursor:pointer;outline:0;vertical-align:middle;background:url(../web-static/images/CheckBox_unchecked_disable@1x.png) no-repeat}#scrollCon{max-height:280px;padding:0 36px}table.dataGrid{border:0}table.dataGrid tr{background:#4cb1d9;border-bottom:solid 1px rgba(255,255,255,0.4);height:44px}table.dataGrid td:nth-child(2){text-align:left}table.dataGrid td:nth-child(3){text-align:right;font-size:12px}table.dataGrid td{border:0}label#refreshBtn{float:right;margin-right:36px;font-size:12px;line-height:24px;color:#fff}i.refresh{background:url(../web-static/images/refresh_normal@1x.png) no-repeat;width:24px;height:24px;display:inline-block;vertical-align:top}#refresh{display:none}</style>