

<div id="hcCo" class="hcCo">
	<div class="hsHelp"></div>
	<div id="online">
		<div class="title">
			<label class="title">{%menuStr.onlineUpgrade%}</label>
		</div>
		<div class="sysUpBlock">
			<p class="upgradeTip">{%label.onlineUpgradeNote%}</p>
			<table id="onlineTbl" class="dataGrid"></table>
		</div>
	</div>
	<div id="local">
		<div class="title">
			<label class="title">{%menuStr.localUpgrade%}</label>
		</div>
		<div class="block sysUpBlock" class="dataGrid"></table>
			<p class="upgradeTip">{%label.localUpgradeNote%}</p>
			<table id="nativeTbl" class="dataGrid"></table>
		</div>
	</div>
</div>
<script type="text/javascript">function init(){function D(a){var c="";switch(parseInt(a)){case ENONE:return!0;case EINVSENDREQMSGFAILED:c=errStr.invSendReqMsgFailed;break;case ESYSBUSY:case EINVLASTOPTIONISNOTFINISHED:c=errStr.invLastOptionIsNotFinished;break;case ESYSTEM:c=errStr.invRequestFail;break;case ENOMEMORY:c=errStr.invMemoryOut;break;case EINVGETDATAFAILED:c=errStr.invGetDataFailed;break;case EINVPARAMETER:c=errStr.invParameter;break;case EINVREQUESTTIMEOUT:c=errStr.invRequestTimeout;break;case EINVDEVICEIDNOTEXIST:case EINVERRORDEVICEIDFORMATERROR:case EINVILLEGALDEVICE:c=
label.cloudDeviceInfoExpt;break;default:a=cloudErrHandle(a),c=!1==a.result?a.tip:errStr.invRequestFail}closeLoading();showAlert(c);return!1}function w(a){switch(a){case ENONE:return!0;case EFWEXCEPTION:case EFWNOTSUPPORTED:case EFILETOOBIG:showAlert(errStr.fwFmtErr);break;case EFWNOTINFLANDBL:case EFWNEWEST:showAlert(errStr.fwNotSupported);break;case EINVMEMORYOUT:case EINVDOWNLOADFWFAILED:case EINVSENDREQMSGFAILED:case EINVREQUESTTIMEOUT:case EINVCONNECTTINGCLOUDSERVER:case EINVLASTOPTIONISNOTFINISHED:case ESYSBUSY:showAlert(errStr.fwDownLoadFailed);
break;default:showAlert(errStr.fwUpgradeFailed)}return!1}function E(){var a=id("fileName").value;return""==a?(showAlert(label.upWarn),!1):-1==a.search(/\.bin$/)?(showAlert(errStr.fileFmttErr),!1):!0}function F(a,c){if(!0!=n)if(clearTimeout(upgradeTimeoutHd),upgradeTimeoutHd=null,closeLoading(),ENONE==a){var b=c.wait_time?1E3*parseInt(c.wait_time):SYSUPGRADE_SECONDS;showProgBar(b,label.upgrading,function(){lanDetecting(function(){window.location.reload()})},!0,statusStr.upgradeTip)}else w(a)}function G(a,
c){if(!0!=n)if(clearTimeout(upgradeTimeoutHd),upgradeTimeoutHd=null,closeLoading(),ENONE==a){var b=c.wait_time?1E3*parseInt(c.wait_time):SYSUPGRADE_SECONDS;showProgBar(b,label.upgrading,function(){closeProgBar();m()},!0,statusStr.upgradeChildRtTip)}else w(a)}function p(){n=!0;id("uploadIf").onload=null;closeLoading();closeProgBar();clearTimeout(upgradeTimeoutHd);showAlert(errStr.upGradeFail);id("uploadIf").innerHTML=""}function x(a){var c=a.data,b;a=ENONE;if(/(<pre>)?(.+)(<\/pre>)+/.test(c)||/(<pre>)?(.+)/.test(c))b=
RegExp.$2;b=JSON.parse(b);a=b[ERR_CODE];a!=ENONE&&(closeLoading(),closeProgBar());G(a,b)}function y(a,c){id("fileName").onchange=function(){var b=this.value,b=b.substring(b.lastIndexOf("\\")+1);id("textfield").value=b};id("sysUpgrade").onclick=function(){if(E()){z();var b={};showLoading(label.fwUploadTip,void 0,void 0,!1);upgradeTimeoutHd=$.setTimeout(p,4E4);if(a)$("#uploadIf").one("load",function(){iFrmOnload("uploadIf",F)}),b[uciSystem.fileName]={},b[uciSystem.fileName][uciSystem.actionName.firmUpgrade]=
{type:"0"},$.action(b,function(b){if(ENONE==b[ERR_CODE]){var a=document.forms[0];a.action=$.orgURL(b.url);a.submit();a.reset();n=!1}else p()});else{var e="http://"+k._ops.data[c].ip,f="undefined"!=typeof gUsernameSupport&&gUsernameSupport?{method:"do",login:{username:$.usr,password:$.pwd}}:{method:"do",login:{password:$.pwd}},d,h;$.ajax({url:e,data:f,type:"POST",async:!0,postDataType:"json",dataType:"json",utf8Encode:!0,success:function(b){b[ERR_CODE]==ENONE?(h=b.stok,d=e+"/stok="+h+"/ds",f={},f[uciSystem.fileName]=
{},f[uciSystem.fileName][uciSystem.actionName.firmUpgrade]={type:"0"},f.method="do",$.ajax({url:d,data:f,type:"POST",async:!0,postDataType:"json",dataType:"json",utf8Encode:!0,success:function(b){if(b[ERR_CODE]==ENONE){var a=document.forms[0];a.action=e+"/stok="+h+b.url;a.submit();a.reset();n=!1}else p()},error:function(){closeLoading();showAlert(errStr.invSendReqMsgFailedNetwork);clearTimeout(upgradeTimeoutHd)}})):p()},error:function(){closeLoading();showAlert(errStr.invSendReqMsgFailedNetwork);
clearTimeout(upgradeTimeoutHd)}})}}}}function z(){var a=id("sysUpgradeNative");hideCoverB(function(){a.style.visibility="hidden";a.style.top="-9999px"})}function H(){l=!1;showLoading(label.upgradeCheckVerTip,function(){l=!0;clearTimeout(A)},void 0,!1);q=new Date;t=q.getTime();onlineUpgradeCheck(D,function(a){!1==l&&(closeLoading(),parseInt(a)==EINVNOTFOUNTNEWFW?showAlert(errStr.invNotFoundNewFw):parseInt(a)==EINVREQUESTTIMEOUT?showAlert(errStr.invSendReqMsgFailedNetwork):showAlert(errStr.invSendReqMsgFailed))},
function(){!1==l&&(q=new Date,u=q.getTime(),m(),2E3>u-t?A=$.setTimeout(function(){closeLoading()},2E3-(u-t)):closeLoading())})}function I(){l=!1;showLoading(statusStr.fwCheckUpInfoTip,function(){l=!0},void 0,!1);onlineUpgrade(function(){!1==l&&(closeLoading(),showAlert(gOnlineUpgradeNote),gOnlineUpgradeNote="")},function(){!1==l&&closeLoading()})}function J(a,c){function b(){var a={};a[uciPlc.fileName]={};a[uciPlc.fileName][KEY_NAME]=uciPlc.secName.startGetExtFwVerStat;$.query(a,function(a){a[ERR_CODE]==
ENONE?"0"==a[uciPlc.fileName][uciPlc.secName.startGetExtFwVerStat][uciPlc.optName.status]?$.setTimeout(b,500):(closeLoading(),m()):(parseInt(a[ERR_CODE])==EINVREQUESTTIMEOUT?showAlert(errStr.invSendReqMsgFailedNetwork):showAlert(errStr.invSendReqMsgFailed),closeLoading())})}var e=k._ops.data[a],f={},d={};f[uciPlc.fileName]={};f[uciPlc.fileName][uciPlc.actionName.startGetExtFwVer]=d;d[uciPlc.optName.mac]=e.mac;$.action(f,function(a){a[ERR_CODE]==ENONE?(showLoading(statusStr.fwCheckUpInfoTip,function(){},
void 0,!1),b()):parseInt(a[ERR_CODE])==EINVREQUESTTIMEOUT?showAlert(errStr.invSendReqMsgFailedNetwork):showAlert(errStr.invSendReqMsgFailed)})}function B(){function a(a){switch(a){case f.readyDownload:case f.downloading:!1==b&&(b=!0,showProgBar(d,statusStr.fwDownloading,function(){},!0));$.setTimeout(c,h);break;case f.readyUpg:case f.upgrading:b&&!e?(clearTimeout(progressBarHd),$(".progressBarPercent")[0].innerHTML="100%",$(".progressBarDe")[0].style.width="100%",e=!0,$.setTimeout(function(){$.setTimeout(c,
h);showProgBar(r,label.upgrading,function(){},!0,statusStr.upgradeChildRtTip)},500)):(e||(e=!0,showProgBar(r,label.upgrading,function(){},!0,statusStr.upgradeChildRtTip)),$.setTimeout(c,h));break;case f.upgSuccess:e&&(clearTimeout(progressBarHd),$(".progressBarPercent")[0].innerHTML="100%",$(".progressBarDe")[0].style.width="100%",setTimeout(function(){closeProgBar();m()},500));break;case f.timeout:closeProgBar();m();break;case f.fail:closeProgBar(),(e||b)&&showAlert(errStr.fwUpgradeFailed)}}function c(){$.query({hyfi:{name:"upgrade_ext_status"}},
function(b){b[ERR_CODE]==ENONE&&a(b.hyfi.upgrade_ext_status.status)})}var b=!1,e=!1,f=uciPlc.optValue.extOlStatus,d=195E3,h=1E3;c()}function K(a,c){function b(){var a={},b={};a[uciPlc.fileName]={};a[uciPlc.fileName][uciPlc.actionName.upgExt]=b;b[uciPlc.optName.mac]=f.mac;$.action(a,function(a){a[ERR_CODE]==ENONE?(r=a.wait_time?1E3*parseInt(a.wait_time):r,$.setTimeout(function(){closeLoading();B()},500)):(parseInt(a[ERR_CODE])==EINVREQUESTTIMEOUT?showAlert(errStr.invSendReqMsgFailedNetwork):showAlert(errStr.invSendReqMsgFailed),
closeLoading())})}function e(){var a={};a[uciPlc.fileName]={};a[uciPlc.fileName][KEY_NAME]=uciPlc.secName.startGetExtFwVerStat;$.query(a,function(a){a[ERR_CODE]==ENONE?(a=a[uciPlc.fileName][uciPlc.secName.startGetExtFwVerStat][uciPlc.optName.status],"0"==a?$.setTimeout(e,500):"1"==a?b():(closeLoading(),m())):(parseInt(a[ERR_CODE])==EINVREQUESTTIMEOUT?showAlert(errStr.invSendReqMsgFailedNetwork):showAlert(errStr.invSendReqMsgFailed),closeLoading())})}var f=k._ops.data[a];showLoading(statusStr.fwCheckUpInfoTip,
function(){},void 0,!1);(function(){var a={},b={};a[uciPlc.fileName]={};a[uciPlc.fileName][uciPlc.actionName.startGetExtFwVer]=b;b[uciPlc.optName.mac]=f.mac;$.action(a,function(a){a[ERR_CODE]==ENONE?e():parseInt(a[ERR_CODE])==EINVREQUESTTIMEOUT?(closeLoading(),showAlert(errStr.invSendReqMsgFailedNetwork)):(closeLoading(),showAlert(errStr.invSendReqMsgFailed))})})()}function m(){if("undefined"==typeof a)var a={};"undefined"!=typeof v&&clearTimeout(v);var c={};c[uciCloudConfig.fileName]={};c[uciCloudConfig.fileName][KEY_NAME]=
[uciCloudConfig.secName.newFirmware,uciCloudConfig.secName.upgradeInfo];c[uciDeviceInfo.fileName]={};c[uciDeviceInfo.fileName][KEY_NAME]=uciDeviceInfo.secName.info;c[uciProto.fileName]={};c[uciProto.fileName][KEY_NAME]=uciProto.secName.dhcp;c[uciPlc.fileName]={};c[uciPlc.fileName][KEY_TABLE]=uciPlc.secType.connectedExt;$.query(c,function(b){if(ENONE==b[ERR_CODE]){if(!C(a,b)){a=b;var c=b[uciDeviceInfo.fileName][uciDeviceInfo.secName.info],f=b[uciProto.fileName][uciProto.secName.dhcp][uciProto.optName.hostName],
d=void 0==c[uciDeviceInfo.optName.swVer]?label.notFoundVersion:c[uciDeviceInfo.optName.swVer],h=b[uciCloudConfig.fileName][uciCloudConfig.secName.newFirmware][uciCloudConfig.optName.fwNewNotify],h=checkNum(h)&&parseInt(h)||uciCloudConfig.optValue.fwNewFalse,l=b[uciCloudConfig.fileName][uciCloudConfig.secName.upgradeInfo],g={};g.name=f;g.cur_fw_version_full=d;g.cur_fw_version=d.split(" ")[0];g.has_new_fw=h==uciCloudConfig.optValue.fwNewTrue&&void 0!=l[uciCloudConfig.optName.version];g.hw_version=c[uciDeviceInfo.optName.hwVer];
g.newest_fw_version=g.has_new_fw?l[uciCloudConfig.optName.version].split(" ")[0]:d.split(" ")[0];g.is_router=!0;b=formatTableData(b[uciPlc.fileName][uciPlc.secType.connectedExt]);c=0;for(f=b.length;c<f;c++)d=b[c],d[uciPlc.optName.supportOlUp]!=uciPlc.optValue.supportOlUp.yes?(d.name=d.name||label.oldVersion,d.cur_fw_version=label.notFoundVersion,d.newest_fw_version=label.notFoundVersion,d.cur_fw_version_full=label.notFoundVersion,d.has_new_fw=null):(d.name=void 0==d.name?label.notFoundVersion:d.name,
d.cur_fw_version=void 0==d.cur_fw_version?label.notFoundVersion:d.cur_fw_version,d.newest_fw_version=void 0==d.newest_fw_version?d.cur_fw_version:d.newest_fw_version,d.cur_fw_version_full=""==d.cur_fw_version?label.notFoundVersion:d.cur_fw_version,d.cur_fw_version=""==d.cur_fw_version.split(" ")[0]?label.notFoundVersion:d.cur_fw_version.split(" ")[0],d.newest_fw_version=d.newest_fw_version.split(" ")[0]||d.cur_fw_version,d.has_new_fw=d.cur_fw_version==label.notFoundVersion||d.newest_fw_version==label.notFoundVersion?
!1:d.newest_fw_version!=d.cur_fw_version?!0:!1);g=[g];g=b.concat(g);k.setDataSource(g);k.refresh();s.setDataSource(g);s.refresh()}v=$.setTimeout(m,3E3)}})}function C(a,c){var b=[],e=[],f;for(f in a)b.push(f);for(f in c)e.push(f);if(b.length!==e.length)return!1;for(e=0;e<b.length;e++)if("[object Array]"==Object.prototype.toString.call(a[b[e]])&&"[object Array]"==Object.prototype.toString.call(c[b[e]])){if(a[b[e]].sort().toString()!==c[b[e]].sort().toString())return!1}else if("[object Object]"==Object.prototype.toString.call(a[b[e]])&&
"[object Object]"==Object.prototype.toString.call(c[b[e]])){if(!C(a[b[e]],c[b[e]]))return!1}else if(a[b[e]]!==c[b[e]])return!1;return!0}window.attachEvent?window.attachEvent("onmessage",function(a){x(a)}):window.addEventListener&&window.addEventListener("message",function(a){x(a)},!1);var k,s,l=!1,n=!1,t,u,q,A,r=195E3,v=void 0;s=new DataGrid;k=new DataGrid;s.init({id:"onlineTbl",data:[],edit:!1,hasSelBox:!1,head:[{field:label.equipName,width:40},{field:label.upCurrSoft,width:12},{field:label.upNewSoft,
width:12},{field:label.operation,width:12}],list:[{edit:!1,name:"name",type:"str",maxSize:40},{edit:!1,name:"cur_fw_version",type:"str"},{edit:!1,name:"newest_fw_version",type:"str"},{edit:!1,name:"has_new_fw",type:"btn",subType:"switch",className:"subBtn tblBtn",classNameUn:"subBtn tblBtn",onStr:btn.fwRemoteUpgrade,offStr:btn.fwCheckVersion,click:function(a,c){var b=k._ops.data[a];b.is_router?b.has_new_fw?I(a,c):H(a,c):b.has_new_fw?K(a,c):J(a,c)}}]});k.init({id:"nativeTbl",data:[],edit:!1,hasSelBox:!1,
head:[{field:label.equipName,width:40},{field:label.upCurrSoft,width:18},{field:label.operation,width:18}],list:[{edit:!1,name:"name",type:"str",maxSize:40},{edit:!1,name:"cur_fw_version",type:"str"},{value:btn.fwLocalUpgrade,type:"btn",click:function(a,c){var b=id("sysUpgradeNative"),e="",f,d=void 0!=k._ops.data[a].cur_fw_version_full?k._ops.data[a].cur_fw_version_full:label.notFoundVersion,h=void 0!=k._ops.data[a].hw_version?k._ops.data[a].hw_version:label.notFoundVersion;void 0!=b?emptyNodes(b):
(b=document.createElement("div"),b.className="VigNetControlCon",b.id="sysUpgradeNative",document.body.appendChild(b));f=document.createElement("div");f.className="eptCon";f.id="eptCon";b.appendChild(f);e+='<h1 class="localUpgrade">'+menuStr.localUpgrade+"</h1>";e=e+'<div style="margin-left: 102px;">'+('<p class="upVersion"><span>'+label.upCurrHard+label.colon+'</span><span id="hardwareVerL">'+h+'</span></p><p class="upVersion" style="margin-top:8px;"><span>'+label.upCurrSoft+label.colon+'</span><span id="softwareVerL">'+
d+"</span></p>");e+='<p class="upDes">'+label.upgradeTip+"</p>";e+='<form enctype="multipart/form-data" id="upFileForm" method="post" target="uploadIf"><div class="fileDiv"><input type="file" class="file" name="fileName" id="fileName" /><div class="buttonArea"><input type="text" id="textfield" class="fileTxt" readonly="true" /><input type="button" value="'+btn.browse+'" class="subBtn fileBrowse" /></div><iframe id="uploadIf" name="uploadIf"></iframe></div><input id="sysUpgrade" type="button" value="'+
btn.upgrade+'" class="btnA subBtn" /><input id="sysUpgradeCancel" type="button" value="'+btn.cancel+'" class="btnA cancelBtn"/></form>';e+="</div>";f.innerHTML=e;id("sysUpgradeCancel").onclick=z;$(".buttonArea").click(function(){$("#fileName").click()});showCoverB(function(){b.style.visibility="visible";b.style.top="150px"});k._ops.data[a].is_router?y(!0,a):y(!1,a)},className:"subBtn tblBtn"}]});m();B()}init();
</script><style type="text/css">table.dataGrid td{height:39px;border:1px solid #1e96d4}div.sysUpBlock{color:#fff;font-size:14px;padding:0 0 0 43px;text-align:left;margin-bottom:30px}p.upgradeTip{margin:30px 0}.tblBtn{height:25px;margin:auto 3px}div.eptCon{background-color:#fff;margin:0 auto;overflow:hidden;position:relative;width:510px;padding:30px 70px 50px}p.upVersion{color:#343434;text-align:left;margin:32px 0 0 0;font-size:12px}p.upDes{color:#343434;text-align:left;margin:24px 0 0 0;font-size:12px}h1.localUpgrade{color:#333;font-size:14px;font-weight:bold}span.softPos{margin-left:30px}.buttonArea{cursor:pointer}div.fileDiv{width:327px;height:34px;margin:10px 0 0 0;overflow:hidden;vertical-align:middle}input.file{font-size:0;display:none}input.fileTxt{width:226px;height:30px;line-height:30px;color:#333;font-size:12px;border:1px solid #1e96d4;border-radius:4px;vertical-align:middle;cursor:pointer}input.fileBrowse{padding:3px 18px;*padding:2px 12px 0;font-size:14px;width:80px;height:30px;margin-left:12px;vertical-align:middle}#sysUpgrade{vertical-align:middle;width:90px!important;font-size:14px;height:30px;margin:30px 0 55px 61px}#sysUpgradeCancel{vertical-align:middle;font-size:14px;width:80px;height:30px;margin:30px 0 55px 12px}#nativeTbl,#onlineTbl{font-size:12px}#upFileForm{height:100px}</style>